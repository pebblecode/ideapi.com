=sub_nav do
  =breadcrumb_list

.col_1

  %h2
    Manage users
    
  %ul.error_messages
    =current_object.errors.full_messages.each do |error|
      %li
        %p=error
    
  - form_for(current_object, :url => brief_path(current_object), :html => { :method => :put, :class => "edit_brief_collaborators" }) do |f|
    =hidden_field_tag 'return_to', collaborators_brief_path(current_object)
    %table.collaborators
      %tr
        %th.user
          &nbsp;
        %th 
          Author
        %th
          Approver
        %th  
          %strong.remove_with_js Remove?
      
      - f.fields_for :user_briefs do |collaboration_form|
        -unless collaboration_form.object.new_record?
          %tr[collaboration_form.object]
            %td.user
              =given_name(collaboration_form.object.user)
            %td=collaboration_form.check_box :author, :class => 'author'
            %td=f.radio_button 'approver_id', collaboration_form.object.user_id, :class => 'approver'
            %td=collaboration_form.check_box '_delete', :class => "remove_item"
    %p.submit=f.submit 'update'
    
  - form_for(current_object, :url => brief_path(current_object), :html => { :method => :put, :class => "edit_brief_collaborators" }) do |add_contact_form|
    =hidden_field_tag 'return_to', collaborators_brief_path(current_object)
    - add_contact_form.fields_for :user_briefs do |add_collab_form|
      -if add_collab_form.object.new_record?
        %p
          -if @users_available_to_add.present?       
            %label{:style => "width: 10em"} Add collaborator
            %p
              =add_collab_form.select "user_id",  @users_available_to_add.map {|u| [given_name(u), u.id] }, { :include_blank => true }
              =add_collab_form.hidden_field "added_by_user_id", :value => current_user.id
              =add_contact_form.submit 'Add to brief'
          -else
            All your contacts are collaborating on this brief
              