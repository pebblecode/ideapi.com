%div[document_item]{:class => (document_item_updated_for_user?(document_item) ? "updated section" : "section")}
  -if document_item.is_heading?
    -if owner?(current_object) and current_object.active?
      - if owner?(current_object) and current_object.active?
        = link_to 'edit', 'javascript:void(0)', :class => 'toggle-inline-edit'
      .show.editable
        %h3=document_item.title
      .edit
        - form_for document_item, :html => {:id => "section_edit_form_#{document_item.id}", :class => "inline-edit-form section-form"} do |form|
          = hidden_field_tag 'render', 'document_item'
          %h3
            = form.text_field :title, :class => 'inline-edit-title'
            = form.submit 'submit', :class => 'submit inline-edit-submit'
            or 
            = link_to 'cancel', 'javascript:void(0)', :class => 'toggle-inline-edit' if owner?(current_object) and current_object.active?
    - else
      .show
        %h3
          =document_item.title
  -else
    - if owner?(current_object) and current_object.active?
      - if owner?(current_object) and current_object.active?
        = link_to 'edit', 'javascript:void(0)', :class => 'toggle-inline-edit btn-shizzle'
      .show.editable
        %h4=document_item.title
        %div.body
          -if document_item.body.present?
            :textile
              #{document_item.body.lstrip}
      .edit
        - form_for document_item, :html => {:id => "section_edit_form_#{document_item.id}", :class => "inline-edit-form section-form"} do |form|
          = hidden_field_tag 'render', 'document_item'
          .field
            %h4
              = form.text_field :title, :class => 'inline-edit-title'
          .field
            = form.text_area :body, :class => 'inline-edit-body'
          .field
            %p.submit.fright            
              = link_to 'cancel', 'javascript:void(0)', :class => 'cancel-inline-edit' if owner?(current_object) and current_object.active?
              or
              = form.submit 'submit', :class => 'submit inline-edit-submit'

        - form_for document_item, :html => {:method => 'delete', :id => "section_delete_form_#{document_item.id}", :class => "section-delete-form"} do |form|
          = form.submit 'delete', :id => "delete_section_#{document_item.id}_submit", :class => 'delete-section-submit', :confirm => "Are you sure you want to delete this section?"


    - else
      .show
        %h4=document_item.title
        %div.body
          -if document_item.body.present?
            :textile
              #{document_item.body.lstrip}
    - unless document_item.is_heading? or @print_mode.present? or current_object.draft?
      %ul.actions
  
        -if current_object.active?
    
          %li=link_to comments_tab(document_item), '#', {:class => 'toggle_document_item_activity'}

      -if current_object.active?
        = render :partial => "documents/activity_stream", :locals => {:document_item => document_item, :current_object => current_object}
    .clear
    