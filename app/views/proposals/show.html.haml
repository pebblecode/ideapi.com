=sub_nav do
  =breadcrumb_list

.col_1
  - unless current_object.draft?
    #idea_show_notes.note
      :markdown
        Idea approvers can update the status of an idea to: 
        ‘Approved’, ‘Needs Work’ or ‘Rejected’. 
        Approvers and the idea owner can collaborate using the comments.
  .proposal
    .title
      %h2
        =current_object.title
        %span.status=current_object.state
        
      -if current_user.owns?(current_object)
        .actions
          = link_to "Show options", "#", :class => "show-options-menu"
    #options-menu
      %ul.object-actions
        %li
          -if current_user.owns?(current_object) # && current_object.draft?
            =link_to 'edit', edit_brief_proposal_path(parent_object, current_object)
    .proposal_item
      :textile
        #{current_object.long_description}
      
    - current_object.assets.each do |asset|
      .proposal_item
        %p.asset
          -if asset.data.content_type =~ /image/
            =link_to image_tag(asset.data.url, :width => "120"), asset.data.url, :rel => "img_fb"
          -else
            =link_to asset.data.original_filename, asset.data.url
          
        %p.description=asset.description if asset.description.present?
        .clear
  
  - if current_user.owns?(current_object) && current_object.draft?
    - form_for(current_object, :url => brief_proposal_path(parent_object, current_object), :html => { :method => :put, :multipart => true }) do |f|
      =f.hidden_field '_call_state', :value => 'publish'
      %p.submit
        = submit_tag "Submit"
      .clear
  
  - unless current_object.draft?    
    .comments_area
      %h4 Idea comments      
      %ul.comments
        - if current_object.comments.blank?
          %li
            %p There have been no comments
        -current_object.comments.each do |comment|
          %li
            %div[comment]
              =small_avatar(comment.user)
              .speech
                %p
                  -if comment.user == current_user or current_object.user == current_user
                    %span.delete-comment
                      = link_to('delete', { :action => "destroy", :controller => 'comments', :id => comment }, :confirm => "Are you sure you want to delete this comment?", :method => :delete)
                  
                  %strong
                    = succeed ':' do
                      =given_name(comment.user)
                  #{strip_tags(comment.comment)}
        %li
          .comment
            #comment_form.comment_form
              =medium_avatar            
              - form_for :comment, :url => comments_path do |f|
                =hidden_field_tag :proposal_id, current_object.id
                .speech
                  =f.text_area :comment, :rows => 5, :cols => 70
                  %p.button=f.submit "submit"
  
        
.col_2

  - if !current_object.draft?
    = render :partial => 'proposals/idea_users'
    .side_box
      %h2 Status of idea
      .contents          
        .update_proposal
          - form_for(current_object, :url => brief_proposal_path(parent_object, current_object), :html => { :method => :put, :multipart => true }) do |f|
            =f.select 'state', options_for_select(Proposal.approval_state_names.map{|s| [s.titleize, s] }, current_object.state.to_s)
            =f.submit "update"
            