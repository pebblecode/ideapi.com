=sub_nav do
  =breadcrumb_list

.col_1
  
  .proposal
    .title
      -if current_user.owns?(current_object) # && current_object.draft?
        .actions
          =link_to 'edit', edit_brief_proposal_path(parent_object, current_object), :class => 'edit_idea edit_icon'
      %h2
        =current_object.title
        %span.status=current_object.state

    .proposal_item
      :textile
        #{current_object.long_description}
      
    - current_object.assets.each do |asset|
      .proposal_item
        %p.asset
          -if asset.data.content_type =~ /image/
            =link_to image_tag(asset.data.url, :width => "120"), asset.data.url, :rel => "img_fb"
          -else
            =link_to asset.data.original_filename, asset.data.url
          
        %p.description=asset.description if asset.description.present?
        .clear
  
  - if current_user.owns?(current_object) && current_object.draft?
    .hr
    - form_for(current_object, :url => brief_proposal_path(parent_object, current_object), :html => { :method => :put, :multipart => true }) do |f|
      =f.hidden_field '_call_state', :value => 'publish'
      %p.submit
        = submit_tag "Submit idea"
      .clear
  
  - unless current_object.draft?    
    .comments_area
      %h4 Comments      
      %ul.comments
        - if current_object.comments.blank?
          %li
            %p There have been no comments
        -current_object.comments.each do |comment|
          %li[comment]        
            %p.comment_body
              =small_avatar(comment.user)
              %span.speech
                %strong
                  = succeed ':' do
                    =given_name(comment.user)
                #{strip_tags(comment.comment)}
                
                -if comment.user == current_user or current_object.author == current_user
                  %span.delete-comment
                    = link_to('delete', { :action => "destroy", :controller => 'comments', :id => comment }, :confirm => "Are you sure you want to delete this comment?", :method => :delete)
                
              %br.clear      
        .comment
          #comment_form.comment_form
            =medium_avatar            
            - form_for :comment, :url => comments_path do |f|
              =hidden_field_tag :proposal_id, current_object.id
              .speech=f.text_area :comment, :rows => 5, :cols => 70
              %p.submit_comment=f.submit "submit"
  
        
.col_2
  - if !current_object.draft? and parent_object.approver?(current_user)
    .side_box
      %h2 Status of idea
      .contents          
        .update_proposal
          - form_for(current_object, :url => brief_proposal_path(parent_object, current_object), :html => { :method => :put, :multipart => true }) do |f|
            %span This idea is currently marked as 
            =parent_object.state
            .clear
            .clear
            
            %span Update idea status to: 
            =f.select 'state', options_for_select(Proposal.approval_state_names.map{|s| [s.titleize, s] }, current_object.state.to_s)
            =f.submit "update"  
  
  %p=link_to 'back to brief', brief_path(parent_object)
  